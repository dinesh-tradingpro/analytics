<div class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <!-- Modern Header -->
    <div class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 transition-colors duration-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo & Title -->
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-900 dark:text-gray-100">TradingPro Analytics</h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Advanced CRM insights</p>
                    </div>
                </div>

                <!-- Header Controls -->
                <div class="flex items-center space-x-4">
                    <!-- Dark/Light Mode Toggle -->
                    <button id="themeToggle" 
                            class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 transition-colors duration-200">
                        <svg id="moonIcon" class="w-5 h-5 text-gray-600 dark:text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.017 8.017 0 1010.586 10.586z"></path>
                        </svg>
                        <svg id="sunIcon" class="hidden w-5 h-5 text-gray-600 dark:text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                        </svg>
                    </button>

                    <!-- Auto-scale Toggle -->
                    <button wire:click="toggleAutoScale" 
                            class="flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200
                                   {{ $autoScale ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200 ring-2 ring-blue-200 dark:ring-blue-800' : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600' }}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                        </svg>
                        <span>Auto Scale</span>
                    </button>

                    <!-- Refresh Button -->
                    <button wire:click="refreshData" wire:loading.attr="disabled"
                            class="flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white rounded-lg font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg wire:loading.remove class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        <div wire:loading class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                        <span wire:loading.remove>Refresh</span>
                        <span wire:loading>Syncing...</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Error Display -->
        @if($error)
            <div class="mb-6 p-4 bg-red-50 dark:bg-red-900/50 border-l-4 border-red-400 dark:border-red-500 rounded-lg">
                <div class="flex">
                    <svg class="w-5 h-5 text-red-400 dark:text-red-300 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                    </svg>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800 dark:text-red-200">Error Loading Data</h3>
                        <p class="text-sm text-red-700 dark:text-red-300 mt-1">{{ $error }}</p>
                    </div>
                </div>
            </div>
        @endif

        <!-- Success Message -->
        @if(session()->has('message'))
            <div class="mb-6 p-4 bg-green-50 dark:bg-green-900/50 border-l-4 border-green-400 dark:border-green-500 rounded-lg">
                <div class="flex">
                    <svg class="w-5 h-5 text-green-400 dark:text-green-300 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-green-800 dark:text-green-200">Success</h3>
                        <p class="text-sm text-green-700 dark:text-green-300 mt-1">{{ session('message') }}</p>
                    </div>
                </div>
            </div>
        @endif

        <!-- Loading State -->
        @if($loading)
            <div class="flex justify-center items-center py-32">
                <div class="text-center">
                    <div class="w-12 h-12 border-4 border-gray-200 dark:border-gray-700 border-t-blue-600 dark:border-t-blue-400 rounded-full animate-spin mx-auto"></div>
                    <p class="mt-4 text-lg font-medium text-gray-700 dark:text-gray-300">Loading analytics data...</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">This may take a moment for large datasets</p>
                </div>
            </div>
        @else
            <!-- Enhanced Analytics Cards with Individual Filters -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                
                <!-- New Users Card -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg dark:shadow-gray-900/20 border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <!-- Card Header -->
                    <div class="p-6 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="p-3 bg-green-100 dark:bg-green-900/50 rounded-lg">
                                    <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">New Users</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">User registrations</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-3xl font-bold text-green-600 dark:text-green-400">
                                    {{ number_format($newUsersData['total_count'] ?? 0) }}
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Total</div>
                            </div>
                        </div>
                        
                        <!-- Controls -->
                        <div class="flex items-center justify-end mt-4">
                            <!-- Chart Type Selector -->
                            <div class="flex items-center space-x-1">
                                <button wire:click="updateNewUsersChartType('line')" 
                                        class="p-2 rounded-md transition-colors duration-200 {{ $newUsersChartType === 'line' ? 'bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300' }}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4" />
                                    </svg>
                                </button>
                                <button wire:click="updateNewUsersChartType('bar')" 
                                        class="p-2 rounded-md transition-colors duration-200 {{ $newUsersChartType === 'bar' ? 'bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300' }}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chart Container -->
                    <div class="p-6">
                        @if(!empty($newUsersData['chart_data']))
                            <div class="h-80 relative">
                                <canvas id="newUsersChart" class="w-full h-full"></canvas>
                            </div>
                        @else
                            <div class="h-80 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <svg class="w-8 h-8 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                                        </svg>
                                    </div>
                                    <p class="text-gray-500 dark:text-gray-400 font-medium">No data available</p>
                                    <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">Run analytics sync to populate data</p>
                                </div>
                            </div>
                        @endif
                    </div>
                </div>

                <!-- Active Users Card -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg dark:shadow-gray-900/20 border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <!-- Card Header -->
                    <div class="p-6 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="p-3 bg-blue-100 dark:bg-blue-900/50 rounded-lg">
                                    <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Active Users</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Recent activity</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">
                                    {{ number_format($activeUsersData['total_count'] ?? 0) }}
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Active</div>
                            </div>
                        </div>
                        
                        <!-- Controls -->
                        <div class="flex items-center justify-end mt-4">
                            <!-- Chart Type Selector -->
                            <div class="flex items-center space-x-1">
                                <button wire:click="updateActiveUsersChartType('area')" 
                                        class="p-2 rounded-md transition-colors duration-200 {{ $activeUsersChartType === 'area' ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300' }}">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M4 12l6-6 4 4 8-8v16H4z"/>
                                    </svg>
                                </button>
                                <button wire:click="updateActiveUsersChartType('line')" 
                                        class="p-2 rounded-md transition-colors duration-200 {{ $activeUsersChartType === 'line' ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300' }}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4" />
                                    </svg>
                                </button>
                                <button wire:click="updateActiveUsersChartType('bar')" 
                                        class="p-2 rounded-md transition-colors duration-200 {{ $activeUsersChartType === 'bar' ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300' }}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chart Container -->
                    <div class="p-6">
                        @if(!empty($activeUsersData['chart_data']))
                            <div class="h-80 relative">
                                <canvas id="activeUsersChart" class="w-full h-full"></canvas>
                            </div>
                        @else
                            <div class="h-80 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <svg class="w-8 h-8 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                        </svg>
                                    </div>
                                    <p class="text-gray-500 dark:text-gray-400 font-medium">No data available</p>
                                    <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">Run analytics sync to populate data</p>
                                </div>
                            </div>
                        @endif
                    </div>
                </div>

                <!-- Inactive Users Card -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg dark:shadow-gray-900/20 border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <!-- Card Header -->
                    <div class="p-6 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="p-3 bg-orange-100 dark:bg-orange-900/50 rounded-lg">
                                    <svg class="w-6 h-6 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Inactive Users</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Dormant accounts</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-3xl font-bold text-orange-600 dark:text-orange-400">
                                    {{ number_format($inactiveUsersData['total_count'] ?? 0) }}
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Inactive</div>
                            </div>
                        </div>
                        
                        <!-- Controls -->
                        <div class="flex items-center justify-between mt-4">
                            <!-- Chart Type Selector -->
                            <div class="flex items-center space-x-1">
                                <button wire:click="updateInactiveUsersChartType('doughnut')" 
                                        class="p-2 rounded-md transition-colors duration-200 {{ $inactiveUsersChartType === 'doughnut' ? 'bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300' }}">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="6"/>
                                        <circle cx="12" cy="12" r="4" fill="none" stroke="white" stroke-width="2"/>
                                    </svg>
                                </button>
                                <button wire:click="updateInactiveUsersChartType('pie')" 
                                        class="p-2 rounded-md transition-colors duration-200 {{ $inactiveUsersChartType === 'pie' ? 'bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300' }}">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="10"/>
                                    </svg>
                                </button>
                                <button wire:click="updateInactiveUsersChartType('bar')" 
                                        class="p-2 rounded-md transition-colors duration-200 {{ $inactiveUsersChartType === 'bar' ? 'bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300' }}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- Quick Stats -->
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                Breakdown available
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chart Container -->
                    <div class="p-6">
                        @if(!empty($inactiveUsersData['chart_data']))
                            <div class="h-80 relative">
                                <canvas id="inactiveUsersChart" class="w-full h-full"></canvas>
                            </div>
                        @else
                            <div class="h-80 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <svg class="w-8 h-8 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <p class="text-gray-500 dark:text-gray-400 font-medium">No data available</p>
                                    <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">Run analytics sync to populate data</p>
                                </div>
                            </div>
                        @endif
                    </div>
                </div>
            </div>

            <!-- Breakdown Stats Section (for inactive users) -->
            @if(!empty($inactiveUsersData['breakdown']))
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg dark:shadow-gray-900/20 border border-gray-200 dark:border-gray-700 p-6 mb-8">
                    <h4 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Dormancy Analysis</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="p-6 bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-lg border border-yellow-200 dark:border-yellow-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h5 class="text-lg font-semibold text-gray-900 dark:text-white">3-6 Months</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Recently inactive</p>
                                </div>
                                <div class="text-3xl font-bold text-yellow-600 dark:text-yellow-400">
                                    {{ number_format($inactiveUsersData['breakdown']['dormant_3_6_months']) }}
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-gray-500 dark:text-gray-400">
                                Potentially recoverable
                            </div>
                        </div>
                        
                        <div class="p-6 bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg border border-orange-200 dark:border-orange-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h5 class="text-lg font-semibold text-gray-900 dark:text-white">6-12 Months</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Moderately inactive</p>
                                </div>
                                <div class="text-3xl font-bold text-orange-600 dark:text-orange-400">
                                    {{ number_format($inactiveUsersData['breakdown']['dormant_6_12_months']) }}
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-gray-500 dark:text-gray-400">
                                Re-engagement needed
                            </div>
                        </div>
                        
                        <div class="p-6 bg-gradient-to-r from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-lg border border-red-200 dark:border-red-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h5 class="text-lg font-semibold text-gray-900 dark:text-white">1+ Years</h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Long-term inactive</p>
                                </div>
                                <div class="text-3xl font-bold text-red-600 dark:text-red-400">
                                    {{ number_format($inactiveUsersData['breakdown']['dormant_1_year_plus']) }}
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-gray-500 dark:text-gray-400">
                                Consider removal
                            </div>
                        </div>
                    </div>
                </div>
            @endif

            <!-- Footer Info -->
            <div class="mt-12 text-center">
                <div class="inline-flex items-center space-x-2 px-4 py-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 text-sm text-gray-600 dark:text-gray-400">
                    <svg class="w-4 h-4 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>Data updates automatically every hour â€¢ Last sync: 
                        @if(isset($newUsersData['cached_at']))
                            {{ \Carbon\Carbon::parse($newUsersData['cached_at'])->diffForHumans() }}
                        @else
                            Never
                        @endif
                    </span>
                </div>
            </div>
        @endif
    </div>
</div>

@push('scripts')
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
@endpush

@if(!$loading && !$error)
    <script wire:key="enhanced-charts-{{ $newUsersChartType }}-{{ $activeUsersChartType }}-{{ $inactiveUsersChartType }}-{{ count($newUsersChartLabels) }}-{{ count($activeUsersChartLabels) }}-{{ count($inactiveUsersChartLabels) }}">
        document.addEventListener('DOMContentLoaded', function () {
            console.log('ðŸŽ¨ Initializing Enhanced Analytics Charts...');
            
            if (typeof Chart === 'undefined') {
                console.error('âŒ Chart.js is not loaded!');
                return;
            }

            let charts = {};
            let isDestroyed = false;
            
            // Store charts globally for cleanup
            window.activeCharts = window.activeCharts || {};
            const autoScale = @json($autoScale);

            // Enhanced chart defaults with better typography and colors
            Chart.defaults.font.family = "'Inter', 'system-ui', 'sans-serif'";
            Chart.defaults.font.size = 12;
            Chart.defaults.color = '#6B7280';
            Chart.defaults.borderColor = '#E5E7EB';

            // Color Palettes
            const colorPalettes = {
                newUsers: {
                    primary: '#10B981',
                    secondary: '#059669',
                    gradient: ['rgba(16, 185, 129, 0.8)', 'rgba(16, 185, 129, 0.1)'],
                    background: 'rgba(16, 185, 129, 0.1)'
                },
                activeUsers: {
                    primary: '#3B82F6',
                    secondary: '#2563EB', 
                    gradient: ['rgba(59, 130, 246, 0.8)', 'rgba(59, 130, 246, 0.1)'],
                    background: 'rgba(59, 130, 246, 0.1)'
                },
                inactive: {
                    colors: ['#F59E0B', '#F97316', '#EF4444'],
                    labels: ['3-6 Months', '6-12 Months', '1+ Years']
                }
            };

            // Enhanced animation configurations
            const animations = {
                tension: {
                    duration: 1000,
                    easing: 'easeOutQuart',
                    from: 1,
                    to: 0,
                    loop: true
                },
                y: {
                    duration: 2000,
                    easing: 'easeInOutElastic',
                    from: (ctx) => ctx.index === 0 ? ctx.chart.height : ctx.chart.height,
                    delay: (ctx) => ctx.dataIndex * 100
                }
            };

            // Cleanup function
            function cleanupCharts() {
                console.log('ðŸ§¹ Cleaning up charts...');
                isDestroyed = true;
                Object.entries(charts).forEach(([key, chart]) => {
                    if (chart && typeof chart.destroy === 'function') {
                        try {
                            const canvas = document.getElementById(key);
                            if (canvas && canvas.ownerDocument) {
                                chart.destroy();
                                console.log(`âœ… Chart ${key} destroyed`);
                            }
                        } catch (e) {
                            console.warn(`âš ï¸  Error destroying chart ${key}:`, e);
                        }
                    }
                });
                charts = {};
            }

            // Enhanced gradient creation
            function createGradient(ctx, colorStart, colorEnd, vertical = true) {
                const gradient = vertical 
                    ? ctx.createLinearGradient(0, 0, 0, ctx.canvas.height)
                    : ctx.createLinearGradient(0, 0, ctx.canvas.width, 0);
                
                gradient.addColorStop(0, colorStart);
                gradient.addColorStop(1, colorEnd);
                return gradient;
            }

            // Canvas validation
            function isCanvasValid(canvas) {
                return canvas && 
                       canvas.ownerDocument && 
                       canvas.isConnected && 
                       canvas.offsetWidth > 0 && 
                       canvas.offsetHeight > 0;
            }

            // Enhanced Line/Bar Chart Creator
            function createEnhancedChart(canvasId, data, config) {
                if (isDestroyed) {
                    console.log(`ðŸš« Chart creation cancelled - component destroyed: ${canvasId}`);
                    return;
                }

                const canvas = document.getElementById(canvasId);
                if (!isCanvasValid(canvas)) {
                    console.warn(`â³ Canvas ${canvasId} not ready, retrying...`);
                    setTimeout(() => {
                        if (!isDestroyed) createEnhancedChart(canvasId, data, config);
                    }, 100);
                    return;
                }

                const ctx = canvas.getContext('2d');
                if (!ctx) {
                    console.error(`âŒ Could not get 2D context for: ${canvasId}`);
                    return;
                }

                // Destroy existing chart
                if (charts[canvasId]) {
                    try {
                        charts[canvasId].destroy();
                    } catch (e) {
                        console.warn(`âš ï¸  Error destroying existing chart ${canvasId}:`, e);
                    }
                }

                // Prepare gradient
                const gradient = createGradient(ctx, config.colors.gradient[0], config.colors.gradient[1]);

                const chartConfig = {
                    type: config.type,
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: config.label,
                            data: data.data,
                            borderColor: config.colors.primary,
                            backgroundColor: config.type === 'line' ? gradient : config.colors.background,
                            borderWidth: config.type === 'line' ? 3 : 2,
                            tension: config.type === 'line' ? 0.4 : 0,
                            fill: config.type === 'line' ? true : false,
                            pointBackgroundColor: config.colors.primary,
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: config.type === 'line' ? 6 : 0,
                            pointHoverRadius: config.type === 'line' ? 8 : 0,
                            pointHoverBackgroundColor: config.colors.secondary,
                            pointHoverBorderWidth: 3,
                            borderRadius: config.type === 'bar' ? 8 : 0,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: {
                            padding: { top: 20, bottom: 20, left: 10, right: 10 }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(229, 231, 235, 0.8)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: { size: 11, weight: '500' },
                                    padding: 8,
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                            },
                            x: {
                                grid: { display: false, drawBorder: false },
                                ticks: {
                                    color: '#6B7280',
                                    font: { size: 11, weight: '500' },
                                    maxRotation: 0,
                                    padding: 8
                                }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#F9FAFB',
                                bodyColor: '#F9FAFB',
                                borderColor: config.colors.primary,
                                borderWidth: 1,
                                cornerRadius: 12,
                                padding: 16,
                                displayColors: false,
                                titleFont: { size: 14, weight: '600' },
                                bodyFont: { size: 13, weight: '500' },
                                callbacks: {
                                    title: (context) => context[0].label,
                                    label: (context) => `${config.label}: ${context.parsed.y.toLocaleString()}`
                                }
                            }
                        },
                        animation: {
                            duration: 1500,
                            easing: 'easeInOutQuart',
                            delay: (context) => {
                                let delay = 0;
                                if (context.type === 'data' && context.mode === 'default') {
                                    delay = context.dataIndex * 50;
                                }
                                return delay;
                            }
                        }
                    }
                };

                try {
                    charts[canvasId] = new Chart(canvas, chartConfig);
                    window.activeCharts[canvasId] = charts[canvasId]; // Store globally for cleanup
                    console.log(`âœ… Enhanced ${config.type} chart created: ${canvasId}`);
                } catch (error) {
                    console.error(`âŒ Error creating chart ${canvasId}:`, error);
                }
            }

            // Enhanced Doughnut/Pie Chart Creator
            function createEnhancedDonutChart(canvasId, data, config) {
                if (isDestroyed) {
                    console.log(`ðŸš« Chart creation cancelled - component destroyed: ${canvasId}`);
                    return;
                }

                const canvas = document.getElementById(canvasId);
                if (!isCanvasValid(canvas)) {
                    console.warn(`â³ Canvas ${canvasId} not ready, retrying...`);
                    setTimeout(() => {
                        if (!isDestroyed) createEnhancedDonutChart(canvasId, data, config);
                    }, 100);
                    return;
                }

                const ctx = canvas.getContext('2d');
                if (!ctx) {
                    console.error(`âŒ Could not get 2D context for: ${canvasId}`);
                    return;
                }

                // Destroy existing chart
                if (charts[canvasId]) {
                    try {
                        charts[canvasId].destroy();
                    } catch (e) {
                        console.warn(`âš ï¸  Error destroying existing chart ${canvasId}:`, e);
                    }
                }

                const chartConfig = {
                    type: config.type,
                    data: {
                        labels: data.labels,
                        datasets: [{
                            data: data.data,
                            backgroundColor: config.colors,
                            borderColor: '#ffffff',
                            borderWidth: 3,
                            hoverBorderWidth: 5,
                            hoverBackgroundColor: config.colors.map(color => color + 'CC'),
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: {
                            padding: { top: 20, bottom: 40, left: 10, right: 10 }
                        },
                        cutout: config.type === 'doughnut' ? '65%' : 0,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 25,
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    font: { size: 12, weight: '500' },
                                    color: '#4B5563',
                                    generateLabels: function(chart) {
                                        const data = chart.data;
                                        if (data.labels.length && data.datasets.length) {
                                            return data.labels.map((label, i) => {
                                                const value = data.datasets[0].data[i];
                                                const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                                const percentage = ((value / total) * 100).toFixed(1);
                                                
                                                return {
                                                    text: `${label} (${percentage}%)`,
                                                    fillStyle: data.datasets[0].backgroundColor[i],
                                                    strokeStyle: data.datasets[0].backgroundColor[i],
                                                    lineWidth: 0,
                                                    pointStyle: 'circle',
                                                    hidden: false,
                                                    index: i
                                                };
                                            });
                                        }
                                        return [];
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#F9FAFB',
                                bodyColor: '#F9FAFB',
                                borderColor: '#F59E0B',
                                borderWidth: 1,
                                cornerRadius: 12,
                                padding: 16,
                                displayColors: true,
                                titleFont: { size: 14, weight: '600' },
                                bodyFont: { size: 13, weight: '500' },
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return `${context.label}: ${context.parsed.toLocaleString()} users (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 2000,
                            easing: 'easeInOutQuart'
                        },
                        onHover: (event, activeElements) => {
                            event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                        }
                    }
                };

                try {
                    charts[canvasId] = new Chart(canvas, chartConfig);
                    console.log(`âœ… Enhanced ${config.type} chart created: ${canvasId}`);
                } catch (error) {
                    console.error(`âŒ Error creating chart ${canvasId}:`, error);
                }
            }

            // Chart initialization function
            function initializeCharts() {
                if (isDestroyed) return;
                console.log('ðŸš€ Initializing all charts...');

                // Get data from Livewire - Fresh data on each script execution
                const newUsersData = {
                    labels: @json($newUsersChartLabels),
                    data: @json($newUsersChartValues)
                };
                const activeUsersData = {
                    labels: @json($activeUsersChartLabels),  
                    data: @json($activeUsersChartValues)
                };
                const inactiveUsersData = {
                    labels: @json($inactiveUsersChartLabels),
                    data: @json($inactiveUsersChartValues)
                };

                // Get chart types
                const newUsersChartType = @json($newUsersChartType);
                const activeUsersChartType = @json($activeUsersChartType);
                const inactiveUsersChartType = @json($inactiveUsersChartType);
                
                // Debug: Log script regeneration to verify updates
                console.log('ðŸ”„ Script regenerated at', new Date().toISOString(), 'with chart types:', {
                    newUsers: @json($newUsersChartType),
                    activeUsers: @json($activeUsersChartType), 
                    inactiveUsers: @json($inactiveUsersChartType)
                });
                
                // Force complete cleanup of any existing charts
                if (window.activeCharts) {
                    Object.values(window.activeCharts).forEach(chart => {
                        if (chart && typeof chart.destroy === 'function') {
                            chart.destroy();
                        }
                    });
                }
                window.activeCharts = {};

                console.log('ðŸ“Š Data loaded:', {
                    newUsers: `${newUsersData.labels.length} points`,
                    activeUsers: `${activeUsersData.labels.length} points`, 
                    inactiveUsers: `${inactiveUsersData.labels.length} points`
                });
                
                // Debug: Show actual labels to verify data is updating
                console.log('ðŸ·ï¸ New Users labels:', newUsersData.labels.slice(0, 5).join(', ') + (newUsersData.labels.length > 5 ? '...' : ''));
                console.log('ðŸ·ï¸ Active Users labels:', activeUsersData.labels.slice(0, 5).join(', ') + (activeUsersData.labels.length > 5 ? '...' : ''));
                console.log('ðŸ“Š Chart types:', { newUsers: newUsersChartType, activeUsers: activeUsersChartType, inactiveUsers: inactiveUsersChartType });

                // Create charts with enhanced configurations
                setTimeout(() => {
                    if (isDestroyed) return;

                    // New Users Chart
                    if (newUsersData.labels.length > 0) {
                        createEnhancedChart('newUsersChart', newUsersData, {
                            type: newUsersChartType,
                            label: 'New Users',
                            colors: colorPalettes.newUsers
                        });
                    }

                    // Active Users Chart  
                    if (activeUsersData.labels.length > 0) {
                        const chartType = activeUsersChartType === 'area' ? 'line' : activeUsersChartType;
                        createEnhancedChart('activeUsersChart', activeUsersData, {
                            type: chartType,
                            label: 'Active Users',
                            colors: colorPalettes.activeUsers
                        });
                    }

                    // Inactive Users Chart
                    if (inactiveUsersData.labels.length > 0) {
                        if (inactiveUsersChartType === 'bar') {
                            createEnhancedChart('inactiveUsersChart', inactiveUsersData, {
                                type: 'bar',
                                label: 'Inactive Users',
                                colors: {
                                    primary: colorPalettes.inactive.colors[0],
                                    secondary: colorPalettes.inactive.colors[1],
                                    gradient: ['rgba(245, 158, 11, 0.8)', 'rgba(245, 158, 11, 0.1)'],
                                    background: 'rgba(245, 158, 11, 0.2)'
                                }
                            });
                        } else {
                            createEnhancedDonutChart('inactiveUsersChart', inactiveUsersData, {
                                type: inactiveUsersChartType,
                                colors: colorPalettes.inactive.colors
                            });
                        }
                    }
                }, 200);
            }

            // Event Listeners
            document.addEventListener('livewire:navigating', cleanupCharts);
            window.addEventListener('beforeunload', cleanupCharts);

            // Livewire event listeners
            document.addEventListener('livewire:initialized', function() {
                console.log('ðŸ”„ Livewire initialized, setting up chart event listeners...');
                
                Livewire.on('newUsersChartUpdated', () => {
                    if (!isDestroyed) {
                        console.log('ðŸ“ˆ New Users chart updated');
                        // Since we're using wire:key, the script will reload automatically
                        // No need to manually reinitialize
                    }
                });

                Livewire.on('activeUsersChartUpdated', () => {
                    if (!isDestroyed) {
                        console.log('âš¡ Active Users chart updated');
                        // Since we're using wire:key, the script will reload automatically
                    }
                });

                Livewire.on('inactiveUsersChartUpdated', () => {
                    if (!isDestroyed) {
                        console.log('ðŸ˜´ Inactive Users chart updated');  
                        // Since we're using wire:key, the script will reload automatically
                    }
                });
            });

            // Initialize charts immediately
            setTimeout(initializeCharts, 300);
        });
    </script>
@endif

<script>
    // Enhanced Dark Mode Toggle
    document.addEventListener('DOMContentLoaded', function() {
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        
        if (!themeToggle || !sunIcon || !moonIcon) {
            console.error('ðŸŒ™ Dark mode toggle elements not found');
            return;
        }
        
        // Get saved theme or default to light
        const savedTheme = localStorage.getItem('theme') || 'light';
        const systemDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        // Set initial theme
        if (savedTheme === 'dark' || (!savedTheme && systemDarkMode)) {
            document.documentElement.classList.add('dark');
            updateIcons(true);
        } else {
            document.documentElement.classList.remove('dark');
            updateIcons(false);
        }
        
        // Toggle theme
        themeToggle.addEventListener('click', function() {
            const isDark = document.documentElement.classList.contains('dark');
            
            if (isDark) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                updateIcons(false);
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                updateIcons(true);
            }
        });
        
        function updateIcons(isDark) {
            if (!sunIcon || !moonIcon) return;
            
            if (isDark) {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        }
        
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            if (!localStorage.getItem('theme')) {
                if (e.matches) {
                    document.documentElement.classList.add('dark');
                    updateIcons(true);
                } else {
                    document.documentElement.classList.remove('dark');
                    updateIcons(false);
                }
            }
        });
    });
</script>